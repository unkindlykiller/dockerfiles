FROM xataz/nginx-php

RUN cd /tmp
RUN wget https://github.com/shaarli/Shaarli/releases/download/v0.10.4/shaarli-v0.10.4-full.tar.gz
RUN tar xzf shaarli-v0.10.4-full.tar.gz
RUN wget https://github.com/kalvn/Shaarli-Material/releases/download/v0.10.4/shaarli-material.v0.10.4.tar.gz
RUN tar xzf shaarli-material.v0.10.4.tar.gz
RUN cd /
RUN mv -f /tmp/Shaarli/* /Shaarli
RUN mv -f /tmp/material/ /Shaarli/tpl/
RUN rm -rf /tmp/*

COPY nginx/sites-enabled/shaarli.conf /nginx/sites-enabled/

COPY nginx/conf.d/*.conf /nginx/conf.d/

COPY startup /usr/local/bin/

RUN chmod +x /usr/local/bin/startup

VOLUME /Shaarli

ENTRYPOINT ["/usr/local/bin/startup"]
CMD ["/bin/s6-svscan", "/etc/s6.d"]
